<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commit Crab Test Page â€” Modified</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .crab-emoji {
            font-size: 4rem;
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes wave {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-10deg);
            }

            75% {
                transform: rotate(10deg);
            }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .metric-label {
            margin-top: 10px;
            opacity: 0.9;
        }

        .button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #ffd700;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="crab-emoji">ðŸ¦€</div>
            <h1>Commit Crab Performance Test (modified)</h1>
            <p>This page is designed to test Lighthouse performance metrics. (edited)</p>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="fcp-value">0ms</div>
                <div class="metric-label">First Contentful Paint</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="lcp-value">0ms</div>
                <div class="metric-label">Largest Contentful Paint</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="cls-value">0.00</div>
                <div class="metric-label">Cumulative Layout Shift</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="tbt-value">0ms</div>
                <div class="metric-label">Total Blocking Time</div>
            </div>
        </div>

        <div style="text-align: center;">
            <button class="button" onclick="simulateWork()">Simulate Heavy Work</button>
            <button class="button" onclick="addContent()">Add Dynamic Content</button>
            <button class="button" onclick="measurePerformance()">Measure Performance</button>
            <button class="button" onclick="generateAIComments()">Generate AI Comments</button>
        </div>

        <div id="dynamic-content"></div>
        <div class="loading-spinner" style="display: none;" id="spinner"></div>

        <div class="footer">
            <p>ðŸš€ Ready for Lighthouse analysis!</p>
            <p><small>Comment "RUN_COMMIT_CRAB" on a PR to trigger the performance audit</small></p>
            <p id="modified-ts" style="margin-top:8px;opacity:0.9;font-size:0.9rem"></p>
        </div>
    </div>

    <script>
        // Simulate some JavaScript work for performance testing
        function simulateWork() {
            const spinner = document.getElementById('spinner');
            spinner.style.display = 'block';

            // Simulate heavy computation
            setTimeout(() => {
                let result = 0;
                for (let i = 0; i < 1000000; i++) {
                    result += Math.random();
                }
                console.log('Heavy work completed:', result);
                spinner.style.display = 'none';
            }, 100);
        }

        function addContent() {
            const container = document.getElementById('dynamic-content');
            const newElement = document.createElement('div');
            newElement.className = 'metric-card';
            newElement.style.marginTop = '20px';
            newElement.innerHTML = `
                <div class="metric-value">${Math.floor(Math.random() * 100)}%</div>
                <div class="metric-label">Dynamic Metric ${Date.now()}</div>
            `;
            container.appendChild(newElement);
        }

        // Generate many simulated AI comment cards in batches to stress the page
        function generateAIComments(count = 500) {
            const container = document.getElementById('dynamic-content');
            const batchSize = 25; // insert in small batches to avoid blocking UI
            let created = 0;

            // Create a small style for AI comment cards if not already present
            if (!document.getElementById('ai-comment-style')) {
                const style = document.createElement('style');
                style.id = 'ai-comment-style';
                style.textContent = `
                .ai-comment { background: rgba(0,0,0,0.15); padding:12px; margin:8px 0; border-radius:8px; color:#fff; }
                .ai-comment .meta { font-size:0.85rem; opacity:0.9; margin-bottom:6px }
                .ai-comment .body { font-size:0.95rem }
                `;
                document.head.appendChild(style);
            }

            function makeComment(i) {
                const card = document.createElement('div');
                card.className = 'ai-comment metric-card';
                const meta = document.createElement('div');
                meta.className = 'meta';
                meta.textContent = `AI Suggestion #${i} Â· ${new Date().toLocaleTimeString()}`;
                const body = document.createElement('div');
                body.className = 'body';
                body.textContent = `Optimize resource loading: consider code-splitting and lazy-loading modules for component ${i % 10}.`;
                card.appendChild(meta);
                card.appendChild(body);
                return card;
            }

            function insertBatch() {
                const frag = document.createDocumentFragment();
                for (let i = 0; i < batchSize && created < count; i++, created++) {
                    frag.appendChild(makeComment(created + 1));
                }
                container.appendChild(frag);

                if (created < count) {
                    // schedule next batch without blocking
                    setTimeout(insertBatch, 50);
                } else {
                    console.log(`Generated ${count} AI comments`);
                }
            }

            insertBatch();
        }

        function measurePerformance() {
            if ('performance' in window) {
                const navigation = performance.getEntriesByType('navigation')[0];
                if (navigation) {
                    // Update the displayed metrics with real values
                    document.getElementById('fcp-value').textContent =
                        Math.round(navigation.loadEventEnd - navigation.fetchStart) + 'ms';
                }

                // Log performance entries
                const entries = performance.getEntries();
                console.log('Performance entries:', entries);
            }
        }

        // Measure performance when page loads
        window.addEventListener('load', () => {
            // populate modified timestamp for visible diff verification
            const ts = new Date().toLocaleString();
            const el = document.getElementById('modified-ts');
            if (el) el.textContent = `Modified: ${ts}`;
            setTimeout(measurePerformance, 1000);
        });

        // Add some performance observers for Core Web Vitals
        if ('PerformanceObserver' in window) {
            // Observe First Contentful Paint
            const fcpObserver = new PerformanceObserver((list) => {
                const entries = list.getEntries();
                entries.forEach((entry) => {
                    if (entry.name === 'first-contentful-paint') {
                        document.getElementById('fcp-value').textContent =
                            Math.round(entry.startTime) + 'ms';
                    }
                });
            });

            try {
                fcpObserver.observe({ entryTypes: ['paint'] });
            } catch (e) {
                console.log('Paint timing not supported');
            }
        }
    </script>
</body>

</html>